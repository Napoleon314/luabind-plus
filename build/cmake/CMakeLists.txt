cmake_minimum_required (VERSION 3.2)
project (luabind_plus_test)

if(MSVC)
	add_definitions(-D_CRT_SECURE_NO_DEPRECATE)
	set(CMAKE_CXX_FLAGS "/DWIN32 /D_WINDOWS /W3 /WX /GR- /EHsc")
	if(NOT MSVC14)
		message(WARNING "This project needs to be compiled by Visual Studio 2015 and above.")
	endif()
else()
	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Werror -fno-rtti -std=c++14")
endif()

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH})
set(CMAKE_COMPILE_PDB_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH})
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH})
foreach( OUTPUTCONFIG ${CMAKE_CONFIGURATION_TYPES} )
    string( TOUPPER ${OUTPUTCONFIG} OUTPUTCONFIG_UPPER )
    set( CMAKE_ARCHIVE_OUTPUT_DIRECTORY_${OUTPUTCONFIG_UPPER} ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH}/${OUTPUTCONFIG} )
    set( CMAKE_COMPILE_PDB_OUTPUT_DIRECTORY_${OUTPUTCONFIG_UPPER} ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH}/${OUTPUTCONFIG} )
    set( CMAKE_LIBRARY_OUTPUT_DIRECTORY_${OUTPUTCONFIG_UPPER} ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH}/${OUTPUTCONFIG} )
    set( CMAKE_RUNTIME_OUTPUT_DIRECTORY_${OUTPUTCONFIG_UPPER} ${PROJECT_BINARY_DIR}/../../bin/${BUILD_CONFIG_PATH}/${OUTPUTCONFIG} )
endforeach( OUTPUTCONFIG CMAKE_CONFIGURATION_TYPES )

file(GLOB_RECURSE LUABIND_INC ${PROJECT_BINARY_DIR} "../../include/luabind/*")
file(GLOB LUABIND_TEST LIST_DIRECTORIES false ${PROJECT_BINARY_DIR} "../../test/*")
file(GLOB_RECURSE VTD_INC ${PROJECT_BINARY_DIR} "../../test/vtd/*")
file(GLOB_RECURSE LUABIND_TEST_LUA_5_3 ${PROJECT_BINARY_DIR} "../../test/lua5.3/*")
file(GLOB_RECURSE LUABIND_TEST_LUA_5_2 ${PROJECT_BINARY_DIR} "../../test/lua5.2/*")
file(GLOB_RECURSE LUABIND_TEST_LUA_5_1 ${PROJECT_BINARY_DIR} "../../test/lua5.1/*")

SOURCE_GROUP("vtd" FILES ${VTD_INC})
SOURCE_GROUP("luabind" FILES ${LUABIND_INC})
SOURCE_GROUP("test" FILES ${LUABIND_TEST})
SOURCE_GROUP("test\\lua" FILES ${LUABIND_TEST_LUA_5_3} ${LUABIND_TEST_LUA_5_2} ${LUABIND_TEST_LUA_5_1})

include_directories(${PROJECT_BINARY_DIR} "../../include")
include_directories(${PROJECT_BINARY_DIR} "../../test")

add_executable(luabind_plus_test_5_3 ${VTD_INC} ${LUABIND_INC} ${LUABIND_TEST} ${LUABIND_TEST_LUA_5_3})
add_executable(luabind_plus_test_5_2 ${VTD_INC} ${LUABIND_INC} ${LUABIND_TEST} ${LUABIND_TEST_LUA_5_2})
add_executable(luabind_plus_test_5_1 ${VTD_INC} ${LUABIND_INC} ${LUABIND_TEST} ${LUABIND_TEST_LUA_5_1})

target_include_directories(luabind_plus_test_5_3 PUBLIC ${PROJECT_BINARY_DIR} "../../test/lua5.3")
target_include_directories(luabind_plus_test_5_2 PUBLIC ${PROJECT_BINARY_DIR} "../../test/lua5.2")
target_include_directories(luabind_plus_test_5_1 PUBLIC ${PROJECT_BINARY_DIR} "../../test/lua5.1")